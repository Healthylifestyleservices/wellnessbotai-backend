<script>
    let usedCodes = [];

    function getCode() {
        let url = window.location.search;
        let code = url.split('code=')[1];
        return code || '';
    }

    function setupBot() {
        let code = getCode();
        let email = document.getElementById('email').value;
        let repid = document.getElementById('repid').value;
        let referral = document.getElementById('referral').value;
        let message = document.getElementById('message');
        let error = document.getElementById('error');
        message.innerHTML = '';
        error.innerHTML = '';

        if (!code || !email || !repid || !referral) {
            error.innerHTML = 'Please fill in all boxes!';
            return;
        }

        if (usedCodes.includes(code)) {
            error.innerHTML = 'Sorry, this link is already used! Buy a new bot at healthlifestyleservices.com.';
            return;
        }

        usedCodes.push(code);
        localStorage.setItem(repid + '-referral', referral);
        let newLink = 'https://healthylifestyleservices.github.io/wellnessbotai-backend/' + repid + '-wellness';
        message.innerHTML = 'Success! Your bot is ready. Use this link for your visitors: ' + newLink + '<br>Copy it and share it—they’ll see your site with a chat box!';
    }
</script>
